<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Herbal Product Traceability</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
  <style>
    .card { border-radius:8px; padding:12px; margin:10px 0; box-shadow:0 1px 3px rgba(0,0,0,0.05); }
    .hidden { display:none; }
  </style>
</head>
<body class="bg-green-50 text-gray-800">

<div id="pageContent">

  <!-- Header -->
  <header class="bg-green-700 text-white p-4 shadow-lg">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
      <h1 class="text-xl font-bold">ðŸŒ¿ Ayur Trace</h1>
      <button onclick="openScanner()" class="bg-white text-green-700 px-4 py-2 rounded-lg shadow hover:bg-green-100">ðŸ“· Scan QR</button>
    </div>
  </header>

  <!-- Carousel (unchanged) -->
  <div class="max-w-6xl mx-auto mt-5">
    <div class="swiper generalSwiper rounded-xl shadow-lg h-48 sm:h-64 md:h-80 lg:h-96">
      <div class="swiper-wrapper">
        <div class="swiper-slide"><img src="https://user-gen-media-assets.s3.amazonaws.com/gemini_images/29458d0c-dcd1-4c65-a56c-7769ff13acb2.png" class="w-full h-full object-cover rounded-xl"></div>
        <div class="swiper-slide"><img src="https://user-gen-media-assets.s3.amazonaws.com/gemini_images/243ce0f2-49cc-44c0-820b-af70d4946e05.png" class="w-full h-full object-cover rounded-xl"></div>
        <div class="swiper-slide"><img src="https://user-gen-media-assets.s3.amazonaws.com/gemini_images/23a582fe-c610-43cc-8621-5704e51302a3.png" class="w-full h-full object-cover rounded-xl"></div>
        <div class="swiper-slide"><img src="https://user-gen-media-assets.s3.amazonaws.com/gemini_images/63a68b16-cd7a-4eb2-836a-28f47fc63864.png" class="w-full h-full object-cover rounded-xl"></div>
        <div class="swiper-slide"><img src="https://user-gen-media-assets.s3.amazonaws.com/gemini_images/IMAGE5.png" class="w-full h-full object-cover rounded-xl"></div>
        <div class="swiper-slide"><img src="https://user-gen-media-assets.s3.amazonaws.com/gemini_images/IMAGE6.png" class="w-full h-full object-cover rounded-xl"></div>
      </div>
      <div class="swiper-pagination"></div>
    </div>
  </div>

  <!-- About Section (unchanged) -->
  <section class="max-w-6xl mx-auto mt-10 bg-white rounded-xl shadow-lg p-8 grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
    <div>
      <h2 class="text-3xl font-bold text-green-700 mb-4">ðŸŒ¿ About Us</h2>
      <p class="text-gray-700 mb-4 leading-relaxed">
        At <strong>Ayur Trace</strong>, we provide complete traceability of herbal products, from farm to consumer, ensuring transparency, quality, and authenticity at every step. Our platform allows customers to track the entire journey of each herbal product, including cultivation, processing, packaging, and delivery. By connecting farmers, processors, distributors, and consumers, <strong>Ayur Trace</strong> promotes trust, safety, and sustainability in the herbal industry.
      </p>
    </div>
    <div>
      <img src="https://user-gen-media-assets.s3.amazonaws.com/gemini_images/fc389ca2-27fb-44cc-a198-39b6a0ea9f03.png" alt="Herbal Farming" class="w-full object-cover rounded-xl shadow-md">
    </div>
  </section>

</div>

<!-- Scanner Modal -->
<div id="scannerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-3xl relative">
    <h3 class="text-lg font-semibold text-green-700 mb-3">ðŸ“¡ Scanning...</h3>
    <div id="reader" class="rounded-lg bg-gray-100 p-3" style="min-height: 400px;"></div>
    <button onclick="closeScanner()" class="absolute top-2 right-2 px-3 py-1 bg-red-600 text-white rounded-full shadow">âœ–</button>
  </div>
</div>

<!-- Chatbot (unchanged) -->
<div id="chatbot" class="fixed bottom-5 right-5 w-80 bg-white rounded-xl shadow-lg border border-gray-200 hidden z-40">
  <div class="bg-green-700 text-white p-3 rounded-t-xl flex justify-between items-center">
    <span>ðŸ’¬ Herbal Assistant</span>
    <button onclick="toggleChatbot()" class="text-white">âœ–</button>
  </div>
  <div id="chatBox" class="p-3 h-64 overflow-auto">
    <p class="text-gray-600 text-sm">Hello ðŸ‘‹ Ask me anything about the product!</p>
  </div>
  <div class="p-2 border-t flex">
    <input id="chatInput" type="text" placeholder="Type a message..." class="flex-1 p-2 text-sm border rounded-l-lg" autocomplete="off">
    <button id="sendBtn" class="bg-green-700 text-white px-3 rounded-r-lg">Send</button>
  </div>
</div>
<button onclick="toggleChatbot()" class="fixed bottom-5 right-5 bg-green-700 text-white p-4 rounded-full shadow-lg z-30">ðŸ’¬</button>

<script>
let scanner;
const WEBSITE_URL = window.location.origin; // Automatically works on deployed domain

function openScanner() {
  document.getElementById("scannerModal").classList.remove("hidden");
  document.getElementById("pageContent").classList.add("filter", "blur-sm");
  scanner = new Html5Qrcode("reader");

  scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 },
    (decodedText) => {
      const batchId = decodedText.trim();
      window.location.href = `${WEBSITE_URL}/batch.html?batchId=${batchId}`;
      closeScanner();
    });
}

function closeScanner() {
  if (scanner) {
    scanner.stop().finally(() => {
      document.getElementById("scannerModal").classList.add("hidden");
      document.getElementById("pageContent").classList.remove("filter", "blur-sm");
    });
  }
}

// Chatbot
function toggleChatbot() { document.getElementById("chatbot").classList.toggle("hidden"); }
const chatInput = document.getElementById("chatInput");
const chatBox = document.getElementById("chatBox");
const sendBtn = document.getElementById("sendBtn");

async function sendMessage() {
  const msg = chatInput.value.trim();
  if (!msg) return;
  const userMsg = document.createElement("p");
  userMsg.className = "text-right text-sm text-green-700 mb-2";
  userMsg.textContent = "You: " + msg;
  chatBox.appendChild(userMsg);
  chatInput.value = "";
  chatBox.scrollTop = chatBox.scrollHeight;

  const botMsg = document.createElement("p");
  botMsg.className = "text-left text-sm text-gray-600 mb-2";
  botMsg.textContent = "Bot: ...thinking...";
  chatBox.appendChild(botMsg);
  chatBox.scrollTop = chatBox.scrollHeight;

  try {
    const res = await fetch("/chat", { method:"POST", headers:{"Content-Type":"application/json"}, body:JSON.stringify({message: msg}) });
    const data = await res.json();
    botMsg.textContent = "Bot: " + (data.reply || "âš  No reply from server.");
    chatBox.scrollTop = chatBox.scrollHeight;
  } catch {
    botMsg.textContent = "Bot: âš  Could not connect to server.";
  }
}

sendBtn.addEventListener("click", sendMessage);
chatInput.addEventListener("keypress", (e)=>{ if(e.key==="Enter"){e.preventDefault(); sendMessage();} });

window.addEventListener("load", () => {
  new Swiper(".generalSwiper", { loop:true, pagination:{el:".swiper-pagination"}, autoplay:{delay:2500} });
});
</script>

</body>
</html>
