<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Batch Details - Ayurtrace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card { border-radius:8px; padding:12px; margin:10px 0; box-shadow:0 1px 3px rgba(0,0,0,0.05); }
    .card:nth-child(odd) { background:#f0fdf4; }
    .card:nth-child(even) { background:#e0f2fe; }
    .hidden { display:none; }
    .backBtn { margin-bottom:10px; display:inline-block; background:#34d399; color:white; padding:6px 12px; border-radius:6px; text-decoration:none; }
  </style>
</head>
<body class="bg-green-50 text-gray-800">

<div class="max-w-4xl mx-auto p-6">

  <a href="index.html" class="backBtn">üè† Back to Home</a>

  <header class="mb-6">
    <h1 class="text-3xl font-bold text-green-700">üåø Batch Details</h1>
    <p class="text-gray-700 mt-1">Scan QR on the product to see its traceability journey.</p>
  </header>

  <div id="batchContent">
    <!-- Batch details will be injected here -->
  </div>

</div>

<script>
function getBatchIdFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get("batchId");
}

function renderSection(container, title, value) {
  const card = document.createElement("div");
  card.className = "card";

  const header = document.createElement("h3");
  header.textContent = title;
  header.className = "font-semibold mb-2 text-green-700";

  const content = document.createElement("p");
  content.textContent = value;

  card.appendChild(header);
  card.appendChild(content);
  container.appendChild(card);
}

async function fetchBatchDetails() {
  const batchId = getBatchIdFromURL();
  const container = document.getElementById("batchContent");
  container.innerHTML = "";

  try {
    // ‚úÖ Correct backend URL
    const res = await fetch(`https://herb-backend-kaiu.onrender.com/api/batch/${batchId}`);
    if (!res.ok) throw new Error("Failed to fetch batch details");
    const data = await res.json();

    // Display batch data
    renderSection(container, "Batch ID", data.batch.batchId || "N/A");
    renderSection(container, "Farmer Name", data.batch.farmer.name || "N/A");
    renderSection(container, "Harvest Date", data.batch.createdAt || "N/A");
    renderSection(container, "Species", data.batch.species || "N/A");
    renderSection(container, "Part Used", data.batch.partUsed || "N/A");
    renderSection(container, "Quantity", data.batch.quantity || "N/A");
    renderSection(container, "Status", data.batch.status || "N/A");

    // Optional: Processor Records
    if (data.processorRecords && data.processorRecords.length > 0) {
      data.processorRecords.forEach((record, index) => {
        renderSection(container, `Processor Record ${index+1} - Product Name`, record.productName || "N/A");
        renderSection(container, `Processor Record ${index+1} - Quantity Processed`, record.quantityProcessed || "N/A");
        renderSection(container, `Processor Record ${index+1} - Drying Method`, record.dryingMethod || "N/A");
        renderSection(container, `Processor Record ${index+1} - Extraction Method`, record.extractionMethod || "N/A");
      });
    }

  } catch (err) {
    const error = document.createElement("p");
    error.textContent = "‚ö† Could not fetch batch details: " + err.message;
    error.className = "text-red-600";
    container.appendChild(error);
  }
}

window.onload = fetchBatchDetails;
</script>

</body>
</html>
